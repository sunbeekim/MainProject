use haru_db;

-- 1. 테이블 생성 (마켓 서비스 테이블)
CREATE TABLE Services (
    service_id BIGINT PRIMARY KEY,                           
    user_id INT(11) UNIQUE,                                   
    service_title VARCHAR(255) NOT NULL,                       
    service_description TEXT NOT NULL,                         
    service_created_at DATETIME DEFAULT CURRENT_TIMESTAMP,     
    service_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    category_id INT,                                          
    FOREIGN KEY (user_id) REFERENCES Users(user_id),          
    FOREIGN KEY (category_id) REFERENCES Categories(category_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM Services;

-- 2. 테이블 생성 (마켓 서비스 정보 테이블)
CREATE TABLE ServiceDetails (
    detail_id BIGINT PRIMARY KEY,                              
    service_description TEXT NOT NULL,                        
    service_time DATETIME,                                    
    service_location VARCHAR(50),                              
    service_place VARCHAR(50),                                  
    service_capacity INT,                                     
    service_payment JSON,                                     
    service_price DECIMAL(10, 2),                             
    service_cancel TEXT,                                      
    service_refund TEXT,                                      
    service_id BIGINT,                                         
    user_id INT(11),                                          
    transaction_type_id BIGINT,                                
    category_id INT,                                          
    FOREIGN KEY (service_id) REFERENCES Services(service_id), 
    FOREIGN KEY (user_id) REFERENCES Users(user_id),         
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id), 
    FOREIGN KEY (category_id) REFERENCES Categories(category_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM ServiceDetails;

-- 3. 테이블 생성 (마켓 카테고리 테이블)
CREATE TABLE Categories (
    category_id INT PRIMARY KEY,                              
    category_name VARCHAR(100) NOT NULL                       
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM  Categories;

-- 4. 테이블 생성 (마켓 가격 테이블)
CREATE TABLE ServicePricing (
    service_pricing_id BIGINT PRIMARY KEY,                    
    service_id BIGINT UNIQUE,                                  
    user_id INT(11) UNIQUE,                                     
    service_price DECIMAL(10, 2) NOT NULL,                       
    service_price_description VARCHAR(255),                     
    detail_id BIGINT,                                           
    FOREIGN KEY (service_id) REFERENCES Services(service_id),   
    FOREIGN KEY (user_id) REFERENCES Users(user_id),            
    FOREIGN KEY (detail_id) REFERENCES ServiceDetails(detail_id)
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM  ServicePricing;

-- 5. 테이블 생성 (마켓 거래 유형 테이블)
CREATE TABLE TransactionTypes (
    transaction_type_id BIGINT PRIMARY KEY,                   
    transaction_type_name ENUM('BUY_REGISTRATION', 'SELL_REGISTRATION', 'BUY_REQUEST', 'SELL_REQUEST') NOT NULL,  
    transaction_type_description TEXT,                        
    service_id BIGINT,                                          
    user_id INT(11),                                            
    FOREIGN KEY (service_id) REFERENCES Services(service_id),   
    FOREIGN KEY (user_id) REFERENCES Users(user_id)           
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM   TransactionTypes;

-- 6. 테이블 생성 (마켓 거래 테이블)
CREATE TABLE Transactions (
    transaction_id BIGINT PRIMARY KEY,                            
    transaction_type_id BIGINT UNIQUE,                            
    transaction_status ENUM('PENDING', 'COMPLETED', 'CANCELLED') NOT NULL, 
    transaction_created_at DATETIME,                              
    transaction_updated_at DATETIME,                              
    service_id BIGINT,                                           
    user_id INT(11),                                             
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id), 
    FOREIGN KEY (service_id) REFERENCES Services(service_id),    
    FOREIGN KEY (user_id) REFERENCES Users(user_id)             
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM Transactions;

-- 7. 테이블 생성 (마켓 구매 등록 테이블)
CREATE TABLE Purchases (
    purchase_id BIGINT PRIMARY KEY,                             
    purchase_status ENUM('PENDING', 'ACCEPTED', 'CANCELED') NOT NULL, 
    purchase_created_at DATETIME,                               
    purchase_updated_at DATETIME,                             
    service_id BIGINT,                                         
    user_id INT(11),                                          
    transaction_id BIGINT,                                      
    transaction_type_id BIGINT,                                 
    FOREIGN KEY (service_id) REFERENCES Services(service_id),  
    FOREIGN KEY (user_id) REFERENCES Users(user_id),          
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id), 
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM Purchases;

-- 8. 테이블 생성 (마켓 판매 등록 테이블)
CREATE TABLE Sales (
    sale_id BIGINT PRIMARY KEY,                                 
    sale_status ENUM('PENDING', 'APPROVED', 'REJECTED') NOT NULL, 
    sale_created_at DATETIME,                                  
    sale_updated_at DATETIME,                                  
    service_id BIGINT,                                         
    user_id INT(11),                                           
    transaction_id BIGINT,                                      
    transaction_type_id BIGINT,                                 
    FOREIGN KEY (service_id) REFERENCES Services(service_id),  
    FOREIGN KEY (user_id) REFERENCES Users(user_id),           
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id), 
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM Sales;

-- 9. 테이블 생성 (마켓 구매 요청 테이블)
CREATE TABLE PurchaseRequests (
    purchase_request_id BIGINT PRIMARY KEY,                     
    request_message TEXT,                                        
    purchase_status ENUM('PENDING', 'APPROVED', 'REJECTED', 'CANCELLED') NOT NULL,
    purchase_created_at TIMESTAMP,                             
    purchase_updated_at TIMESTAMP,                                
    service_id BIGINT,                                           
    user_id INT(11),                                             
    transaction_id BIGINT,                                        
    transaction_type_id BIGINT,                                  
    FOREIGN KEY (service_id) REFERENCES Services(service_id),     
    FOREIGN KEY (user_id) REFERENCES Users(user_id),            
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id), 
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM PurchaseRequests;

-- 10. 테이블 생성 (마켓 판매 요청 테이블)
CREATE TABLE SaleRequests (
    sale_request_id BIGINT PRIMARY KEY,                         
    sale_status ENUM('PENDING', 'APPROVED', 'REJECTED', 'CANCELLED') NOT NULL,
    sale_created_at TIMESTAMP,                                   
    sale_updated_at TIMESTAMP,                                   
    service_id BIGINT,                                          
    user_id INT(11),                                            
    transaction_id BIGINT,                                       
    transaction_type_id BIGINT,                                   
    service_pricing_id BIGINT,                                   
    FOREIGN KEY (service_id) REFERENCES Services(service_id),    
    FOREIGN KEY (user_id) REFERENCES Users(user_id),             
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id), 
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id), 
    FOREIGN KEY (service_pricing_id) REFERENCES ServicePricing(service_pricing_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM SaleRequests;

-- 11. 테이블 생성 (마켓 리뷰 테이블)
CREATE TABLE Reviews (
    transaction_id BIGINT PRIMARY KEY,                          
    review_rating TINYINT NOT NULL,                              
    review_comment TEXT,                                        
    review_created_at DATETIME,                                 
    service_id BIGINT,                                         
    user_id INT(11),                                            
    FOREIGN KEY (service_id) REFERENCES Services(service_id),    
    FOREIGN KEY (user_id) REFERENCES Users(user_id)             
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM Reviews;

-- 12. 테이블 생성 (마켓 채팅방 테이블)
CREATE TABLE ChatRooms (
    chat_room_id BIGINT PRIMARY KEY,                            
    chat_created_at TIMESTAMP,                                   
    chat_updated_at TIMESTAMP,                                    
    chat_is_group BOOLEAN,                                        
    transaction_id BIGINT,                                        
    transaction_type_id BIGINT,                                   
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id),  
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM ChatRooms;

-- 13. 테이블 생성 (마켓 채팅방 참여자 테이블)
CREATE TABLE ChatRoomParticipants (
    participant_id BIGINT PRIMARY KEY,                         
    joined_at TIMESTAMP,                                          
    chat_room_id BIGINT,                                          
    user_id INT(11),                                               
    FOREIGN KEY (chat_room_id) REFERENCES ChatRooms(chat_room_id), 
    FOREIGN KEY (user_id) REFERENCES Users(user_id)                
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM ChatRoomParticipants;

-- 14. 테이블 생성 (마켓 채팅 메시지 테이블)
CREATE TABLE ChatMessages (
    chat_message_id BIGINT PRIMARY KEY,                            
    chat_message_type ENUM('TEXT', 'IMAGE', 'VIDEO', 'FILE'),         
    chat_content TEXT,                                            
    chat_sent_at TIMESTAMP,                                           
    chat_is_deleted BOOLEAN,                                          
    chat_room_id BIGINT,                                              
    user_id INT(11),                                                 
    transaction_id BIGINT,                                            
    transaction_type_id BIGINT,                                       
    FOREIGN KEY (chat_room_id) REFERENCES ChatRooms(chat_room_id),    
    FOREIGN KEY (user_id) REFERENCES Users(user_id),               
    FOREIGN KEY (transaction_id) REFERENCES Transactions(transaction_id), 
    FOREIGN KEY (transaction_type_id) REFERENCES TransactionTypes(transaction_type_id) 
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM ChatMessages;

-- 15. 테이블 생성 (마켓 메시지 수신 테이블)
CREATE TABLE ChatRecipients (
    recipient_id BIGINT PRIMARY KEY,                                  
    chat_read_at TIMESTAMP,                                           
    chat_message_id BIGINT,                                           
    user_id INT(11),                                                  
    FOREIGN KEY (chat_message_id) REFERENCES ChatMessages(chat_message_id), 
    FOREIGN KEY (user_id) REFERENCES Users(user_id)                   
)ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
SELECT * FROM ChatRecipients;
